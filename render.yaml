services:
  # Web Service - Flask App with WebSocket support
  - type: web
    name: qunex-trade
    runtime: python
    env: python
    region: oregon
    plan: free
    branch: main
    buildCommand: bash build.sh
    startCommand: cd web && gunicorn --worker-class eventlet -w 1 --bind 0.0.0.0:$PORT --timeout 120 app:app
    runtimeVersion: "3.13.1"
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: PYTHON_VERSION
        value: 3.13.1
      - key: ENABLE_BACKGROUND_THREAD
        value: false
      # Add these in Render Dashboard:
      # - DATABASE_URL (from Supabase PostgreSQL - permanent free!)
      # - REDIS_URL (from Upstash)
      # - POLYGON_API_KEY
      # - NEWSAPI_KEY
      # - ANTHROPIC_API_KEY
      # - MAIL_USERNAME
      # - MAIL_PASSWORD
      # - RECAPTCHA_SECRET_KEY

  # Background Worker - Polygon WebSocket Client
  - type: worker
    name: qunex-websocket-worker
    runtime: python
    env: python
    region: oregon
    plan: free
    branch: main
    buildCommand: bash build.sh
    startCommand: python scripts/polygon_websocket_client.py
    runtimeVersion: "3.13.1"
    envVars:
      # Inherits REDIS_URL, POLYGON_API_KEY from environment

  # Cron Job - Data Refresh (runs every hour)
  - type: cron
    name: qunex-data-refresh
    runtime: python
    env: python
    region: oregon
    plan: free
    branch: main
    schedule: "0 * * * *"  # Every hour at minute 0
    buildCommand: bash build.sh
    startCommand: python scripts/refresh_data_cron.py
    runtimeVersion: "3.13.1"
    envVars:
      # Inherits DATABASE_URL, REDIS_URL, API keys from environment

  # Cron Job - AI Score Update (runs every hour)
  - type: cron
    name: qunex-ai-score-update
    runtime: python
    env: python
    region: oregon
    plan: free
    branch: main
    schedule: "0 * * * *"  # Every hour at minute 0 (same as data refresh)
    buildCommand: bash build.sh
    startCommand: python cron_update_ai_scores.py
    runtimeVersion: "3.13.1"
    envVars:
      # Inherits DATABASE_URL, POLYGON_API_KEY from environment

  # Cron Job - Model Retraining (runs weekly on Sunday at midnight)
  - type: cron
    name: qunex-model-retrain
    runtime: python
    env: python
    region: oregon
    plan: free
    branch: main
    schedule: "0 0 * * 0"  # Every Sunday at 00:00 UTC
    buildCommand: bash build.sh
    startCommand: python scripts/cron_retrain_model.py
    runtimeVersion: "3.13.1"
    envVars:
      # Inherits DATABASE_URL, POLYGON_API_KEY from environment

  # Cron Job - Backtest Processor (runs every minute)
  - type: cron
    name: qunex-backtest-processor
    runtime: python
    env: python
    region: oregon
    plan: free
    branch: main
    schedule: "* * * * *"  # Every minute
    buildCommand: bash build.sh
    startCommand: python scripts/cron_run_backtests.py
    runtimeVersion: "3.13.1"
    envVars:
      # Inherits DATABASE_URL, POLYGON_API_KEY from environment

# No databases section - using Supabase PostgreSQL (permanent free tier)
# Add DATABASE_URL in Render Dashboard pointing to Supabase
