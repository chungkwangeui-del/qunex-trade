{% extends "base_layout.html" %}

{% block title %}Scalp Trading - Candlestick + Volume Analysis - Qunex Trade{% endblock %}

{% block extra_styles %}
<style>
    /* Search Section */
    .search-section {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        padding: 24px;
        margin-bottom: 24px;
    }

    .search-form {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .search-input {
        flex: 1;
        max-width: 300px;
        padding: 12px 16px;
        background: var(--bg-hover);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-lg);
        color: var(--text-primary);
        font-size: 1rem;
        font-family: 'JetBrains Mono', monospace;
        text-transform: uppercase;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--accent-cyan);
        box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
    }

    .search-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
        border: none;
        border-radius: var(--radius-lg);
        color: #000;
        font-weight: var(--font-semibold);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0, 217, 255, 0.3);
    }

    .timeframe-tabs {
        display: flex;
        gap: 8px;
        margin-left: auto;
    }

    .timeframe-tab {
        padding: 8px 14px;
        background: transparent;
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-md);
        color: var(--text-tertiary);
        font-size: var(--text-sm);
        font-family: 'JetBrains Mono', monospace;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .timeframe-tab:hover {
        background: var(--bg-hover);
        color: var(--text-primary);
        border-color: rgba(0, 217, 255, 0.3);
    }

    .timeframe-tab.active {
        background: rgba(0, 217, 255, 0.1);
        color: var(--accent-cyan);
        border-color: var(--accent-cyan);
    }

    /* Main Grid */
    .scalp-grid {
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 24px;
    }

    @media (max-width: 1200px) {
        .scalp-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Chart Section */
    .chart-section {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        overflow: hidden;
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border-subtle);
    }

    .ticker-display {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .ticker-symbol {
        font-size: 1.5rem;
        font-weight: var(--font-bold);
        font-family: 'JetBrains Mono', monospace;
        background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .ticker-price {
        font-size: 1.25rem;
        font-weight: var(--font-semibold);
        font-family: 'JetBrains Mono', monospace;
    }

    .ticker-change {
        font-size: var(--text-sm);
        padding: 4px 10px;
        border-radius: var(--radius-sm);
    }

    .ticker-change.positive {
        color: var(--success);
        background: rgba(34, 197, 94, 0.1);
    }

    .ticker-change.negative {
        color: var(--danger);
        background: rgba(239, 68, 68, 0.1);
    }

    /* Analysis Panel */
    .analysis-panel {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .signal-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        padding: 28px 24px;
        text-align: center;
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
    }

    .signal-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--border-subtle);
    }

    .signal-card.bullish {
        border-color: rgba(34, 197, 94, 0.3);
        background: linear-gradient(180deg, rgba(34, 197, 94, 0.08) 0%, rgba(34, 197, 94, 0.02) 100%);
        box-shadow: 0 0 30px rgba(34, 197, 94, 0.1);
    }

    .signal-card.bullish::before {
        background: linear-gradient(90deg, transparent, var(--success), transparent);
    }

    .signal-card.bearish {
        border-color: rgba(239, 68, 68, 0.3);
        background: linear-gradient(180deg, rgba(239, 68, 68, 0.08) 0%, rgba(239, 68, 68, 0.02) 100%);
        box-shadow: 0 0 30px rgba(239, 68, 68, 0.1);
    }

    .signal-card.bearish::before {
        background: linear-gradient(90deg, transparent, var(--danger), transparent);
    }

    .signal-card.neutral {
        border-color: rgba(234, 179, 8, 0.3);
        background: linear-gradient(180deg, rgba(234, 179, 8, 0.08) 0%, rgba(234, 179, 8, 0.02) 100%);
        box-shadow: 0 0 30px rgba(234, 179, 8, 0.1);
    }

    .signal-card.neutral::before {
        background: linear-gradient(90deg, transparent, #eab308, transparent);
    }

    .signal-icon {
        width: 56px;
        height: 56px;
        margin: 0 auto 16px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .signal-icon.bullish {
        background: rgba(34, 197, 94, 0.15);
        border: 2px solid var(--success);
    }

    .signal-icon.bearish {
        background: rgba(239, 68, 68, 0.15);
        border: 2px solid var(--danger);
    }

    .signal-icon.neutral {
        background: rgba(234, 179, 8, 0.15);
        border: 2px solid #eab308;
    }

    .signal-icon.loading {
        background: rgba(0, 217, 255, 0.1);
        border: 2px solid var(--border-subtle);
    }

    .signal-icon::before {
        content: '';
        position: absolute;
    }

    .signal-icon.bullish::before {
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 16px solid var(--success);
    }

    .signal-icon.bearish::before {
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 16px solid var(--danger);
    }

    .signal-icon.neutral::before {
        width: 20px;
        height: 4px;
        background: #eab308;
        border-radius: 2px;
    }

    .signal-icon.loading::before {
        width: 24px;
        height: 24px;
        border: 3px solid var(--border-subtle);
        border-top-color: var(--accent-cyan);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    .signal-text {
        font-size: 1.5rem;
        font-weight: var(--font-bold);
        margin-bottom: 8px;
    }

    .signal-text.bullish { color: var(--success); }
    .signal-text.bearish { color: var(--danger); }
    .signal-text.neutral { color: #eab308; }

    .signal-confidence {
        font-size: var(--text-sm);
        color: var(--text-secondary);
    }

    /* Reasoning List */
    .reasoning-list {
        margin-top: 12px;
        text-align: left;
        font-size: var(--text-xs);
        color: var(--text-tertiary);
    }

    .reasoning-item {
        padding: 4px 0;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .reasoning-item::before {
        content: "‚Ä¢";
        color: var(--accent-cyan);
    }

    /* Cards */
    .indicators-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        padding: 20px;
        transition: border-color var(--transition-fast);
    }

    .indicators-card:hover {
        border-color: rgba(0, 217, 255, 0.2);
    }

    .card-title {
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text-secondary);
    }

    .card-badge {
        font-size: 10px;
        padding: 3px 8px;
        border-radius: var(--radius-sm);
        background: rgba(0, 217, 255, 0.1);
        color: var(--accent-cyan);
        font-weight: var(--font-semibold);
        font-family: 'JetBrains Mono', monospace;
        border: 1px solid rgba(0, 217, 255, 0.2);
    }

    .indicator-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }

    .indicator-row:last-child {
        border-bottom: none;
    }

    .indicator-name {
        color: var(--text-tertiary);
        font-size: var(--text-sm);
    }

    .indicator-value {
        font-family: 'JetBrains Mono', monospace;
        font-weight: var(--font-medium);
        font-size: var(--text-sm);
    }

    .indicator-value.bullish { color: var(--success); }
    .indicator-value.bearish { color: var(--danger); }

    /* Pattern Badge */
    .pattern-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
        margin: 2px;
    }

    .pattern-badge.bullish {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .pattern-badge.bearish {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .pattern-badge.neutral {
        background: rgba(234, 179, 8, 0.1);
        color: #eab308;
        border: 1px solid rgba(234, 179, 8, 0.3);
    }

    /* Volume Bar */
    .volume-bar-container {
        margin-top: 8px;
        background: var(--bg-hover);
        border-radius: var(--radius-sm);
        height: 8px;
        overflow: hidden;
    }

    .volume-bar {
        height: 100%;
        border-radius: var(--radius-sm);
        transition: width 0.3s ease;
    }

    .volume-bar.low { background: var(--text-tertiary); }
    .volume-bar.normal { background: var(--accent-cyan); }
    .volume-bar.high { background: var(--success); }
    .volume-bar.spike { background: linear-gradient(135deg, var(--success), #22c55e); }

    /* AI Analysis Card */
    .ai-analysis-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        padding: 20px;
        flex: 1;
        transition: border-color var(--transition-fast);
    }

    .ai-analysis-card:hover {
        border-color: rgba(0, 217, 255, 0.2);
    }

    .ai-analysis-content {
        font-size: var(--text-sm);
        line-height: 1.7;
        color: var(--text-secondary);
    }

    .ai-analysis-content strong {
        color: var(--text-primary);
    }

    /* Trade Setup Box */
    .trade-setup-box {
        background: linear-gradient(180deg, rgba(0, 217, 255, 0.03) 0%, transparent 100%);
        border: 1px solid rgba(0, 217, 255, 0.15);
        border-radius: var(--radius-lg);
        padding: 16px;
        margin-top: 16px;
    }

    .trade-setup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .trade-setup-title {
        font-weight: var(--font-semibold);
        font-size: var(--text-xs);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-secondary);
    }

    .trade-setup-rr {
        font-family: 'JetBrains Mono', monospace;
        padding: 4px 10px;
        background: rgba(234, 179, 8, 0.1);
        color: #eab308;
        border-radius: var(--radius-sm);
        font-size: var(--text-xs);
        font-weight: var(--font-bold);
        border: 1px solid rgba(234, 179, 8, 0.2);
    }

    .entry-exit-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
    }

    .entry-exit-label {
        color: var(--text-tertiary);
        font-size: var(--text-sm);
    }

    .entry-exit-value {
        font-family: 'JetBrains Mono', monospace;
        font-weight: var(--font-semibold);
    }

    .entry-exit-value.green { color: var(--success); }
    .entry-exit-value.red { color: var(--danger); }
    .entry-exit-value.yellow { color: #eab308; }

    .reasoning-text {
        font-size: var(--text-xs);
        color: var(--text-tertiary);
        margin-top: 4px;
        font-style: italic;
    }

    /* Loading State */
    .loading-overlay {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 48px;
        color: var(--text-tertiary);
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--border-subtle);
        border-top-color: var(--accent-cyan);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 24px;
        color: var(--text-tertiary);
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
        background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(139, 92, 246, 0.1));
        border: 1px solid var(--border-subtle);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .empty-icon::before {
        content: '';
        width: 32px;
        height: 24px;
        border: 3px solid var(--accent-cyan);
        border-radius: 4px;
        position: relative;
    }

    .empty-icon::after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
        border-radius: 50%;
        bottom: 20px;
        right: 24px;
    }

    .empty-title {
        font-size: 1.25rem;
        font-weight: var(--font-semibold);
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .empty-desc {
        font-size: var(--text-sm);
        max-width: 300px;
        margin: 0 auto;
    }

    /* Risk Warning */
    .risk-warning {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: var(--radius-lg);
        padding: 12px 16px;
        font-size: var(--text-xs);
        color: var(--text-secondary);
        margin-top: 16px;
    }

    .risk-warning strong {
        color: var(--danger);
    }

    /* Strategy Info */
    .strategy-info {
        background: rgba(0, 217, 255, 0.05);
        border: 1px solid rgba(0, 217, 255, 0.2);
        border-radius: var(--radius-lg);
        padding: 12px 16px;
        font-size: var(--text-xs);
        color: var(--text-secondary);
        margin-bottom: 24px;
    }

    .strategy-info strong {
        color: var(--accent-cyan);
    }

    .strategy-weights {
        display: flex;
        gap: 16px;
        margin-top: 8px;
    }

    .weight-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .weight-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .weight-dot.candle { background: var(--accent-cyan); }
    .weight-dot.volume { background: var(--accent-purple); }
    .weight-dot.vwap { background: #eab308; }
    .weight-dot.confluence { background: var(--success); }

    /* Confluence Card */
    .confluence-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        padding: 20px;
        transition: all var(--transition-fast);
    }

    .confluence-card.met {
        border-color: rgba(34, 197, 94, 0.4);
        background: linear-gradient(180deg, rgba(34, 197, 94, 0.08) 0%, transparent 100%);
    }

    .confluence-card.not-met {
        border-color: rgba(234, 179, 8, 0.4);
        background: linear-gradient(180deg, rgba(234, 179, 8, 0.08) 0%, transparent 100%);
    }

    .confluence-status {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        border-radius: var(--radius-md);
        margin-bottom: 16px;
        font-weight: var(--font-semibold);
        font-size: var(--text-sm);
    }

    .confluence-status.met {
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .confluence-status.not-met {
        background: rgba(234, 179, 8, 0.15);
        color: #eab308;
        border: 1px solid rgba(234, 179, 8, 0.3);
    }

    .confluence-reasons {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .reason-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
    }

    .reason-item.bullish {
        border-left: 3px solid var(--success);
    }

    .reason-item.bearish {
        border-left: 3px solid var(--danger);
    }

    .reason-text {
        color: var(--text-secondary);
        flex: 1;
    }

    .reason-score {
        font-family: 'JetBrains Mono', monospace;
        font-weight: var(--font-semibold);
        font-size: var(--text-xs);
        padding: 2px 8px;
        border-radius: var(--radius-sm);
    }

    .reason-score.bullish {
        background: rgba(34, 197, 94, 0.15);
        color: var(--success);
    }

    .reason-score.bearish {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
    }

    /* Advanced Analysis Cards */
    .advanced-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-xl);
        padding: 20px;
        transition: border-color var(--transition-fast);
    }

    .advanced-card:hover {
        border-color: rgba(0, 217, 255, 0.2);
    }

    .zone-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: var(--radius-md);
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
        margin: 4px 0;
    }

    .zone-badge.bullish {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .zone-badge.bearish {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .zone-badge.special {
        background: rgba(139, 92, 246, 0.15);
        color: var(--accent-purple);
        border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .double-engulfing-badge {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(0, 217, 255, 0.2));
        color: var(--text-primary);
        border: 1px solid var(--accent-purple);
        padding: 8px 14px;
        border-radius: var(--radius-md);
        font-weight: var(--font-bold);
        text-align: center;
        margin: 8px 0;
    }

    /* Exit Warning */
    .exit-warning {
        background: rgba(234, 179, 8, 0.15);
        border: 1px solid rgba(234, 179, 8, 0.4);
        border-radius: var(--radius-md);
        padding: 12px 16px;
        margin-top: 12px;
        font-size: var(--text-sm);
        color: #eab308;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .exit-warning::before {
        content: "‚ö†Ô∏è";
    }

    /* Fakeout/Trap Card */
    .trap-badge {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(0, 217, 255, 0.2));
        border: 1px solid var(--success);
        padding: 12px 16px;
        border-radius: var(--radius-lg);
        margin-top: 8px;
    }

    .trap-badge .trap-title {
        font-weight: var(--font-bold);
        color: var(--success);
        margin-bottom: 4px;
    }

    .trap-badge .trap-detail {
        font-size: var(--text-xs);
        color: var(--text-secondary);
    }

    .trap-badge.bearish {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(139, 92, 246, 0.2));
        border-color: var(--danger);
    }

    .trap-badge.bearish .trap-title {
        color: var(--danger);
    }
</style>
{% endblock %}

{% block content %}
<div class="content-header">
    <div>
        <h1 class="content-title">Scalp Trading Analysis</h1>
        <p class="content-subtitle">Candlestick + Volume based signals with clear entry/stop/target reasoning</p>
    </div>
</div>

<!-- Strategy Info - ÏâΩÏïå Strategy -->
<div class="strategy-info">
    <strong>Strategy:</strong> ÏâΩÏïå Trading Method - Confluence-based scalping with minimum 2 reasons required for entry
    <div class="strategy-weights">
        <div class="weight-item"><span class="weight-dot candle"></span> Order Blocks (Ïû•ÏïÖÌòï)</div>
        <div class="weight-item"><span class="weight-dot volume"></span> FVG (Fair Value Gap)</div>
        <div class="weight-item"><span class="weight-dot vwap"></span> Fakeout/Trap</div>
        <div class="weight-item"><span class="weight-dot confluence"></span> Confluence Scoring</div>
    </div>
    <div style="margin-top: 8px; font-size: var(--text-xs); color: var(--text-tertiary);">
        <strong style="color: var(--accent-cyan);">Key Rule:</strong> ÏµúÏÜå 2Í∞ú Í∑ºÍ±∞ ÌïÑÏöî (Minimum 2 confluences required) |
        <strong style="color: var(--success);">US Stocks</strong> &amp;
        <strong style="color: #f7931a;">Crypto</strong> supported
    </div>
</div>

<!-- Search Section -->
<div class="search-section">
    <form class="search-form" id="searchForm" onsubmit="return analyzeStock(event)">
        <input type="text" class="search-input" id="tickerInput" placeholder="AAPL or BTCUSDT" maxlength="12" required>
        <button type="submit" class="search-btn" id="analyzeBtn">Analyze</button>
        <div class="timeframe-tabs">
            <button type="button" class="timeframe-tab" data-interval="1" onclick="setTimeframe('1')">1m</button>
            <button type="button" class="timeframe-tab active" data-interval="5" onclick="setTimeframe('5')">5m</button>
            <button type="button" class="timeframe-tab" data-interval="15" onclick="setTimeframe('15')">15m</button>
        </div>
    </form>
</div>

<!-- Main Content -->
<div class="scalp-grid">
    <!-- Chart Section -->
    <div class="chart-section">
        <div class="chart-header" id="chartHeader" style="display: none;">
            <div class="ticker-display">
                <span class="ticker-symbol" id="displayTicker">--</span>
                <span class="ticker-price" id="displayPrice">$--</span>
                <span class="ticker-change" id="displayChange">--</span>
            </div>
        </div>
        <div id="chartContainer">
            <div class="empty-state">
                <div class="empty-icon"></div>
                <div class="empty-title">Enter a Ticker Symbol</div>
                <div class="empty-desc">Search for US stocks (AAPL, TSLA) or crypto pairs (BTCUSDT, ETHUSDT) for candlestick pattern analysis</div>
            </div>
        </div>
    </div>

    <!-- Analysis Panel -->
    <div class="analysis-panel" id="analysisPanel" style="display: none;">
        <!-- Signal Card -->
        <div class="signal-card" id="signalCard">
            <div class="signal-icon loading" id="signalIcon"></div>
            <div class="signal-text" id="signalText">Analyzing...</div>
            <div class="signal-confidence" id="signalConfidence">--</div>
            <div class="reasoning-list" id="reasoningList"></div>
        </div>

        <!-- Confluence Analysis (ÏâΩÏïå Strategy) -->
        <div class="confluence-card" id="confluenceCard">
            <div class="card-title">
                Confluence Analysis
                <span class="card-badge">ÏâΩÏïå</span>
            </div>
            <div class="confluence-status not-met" id="confluenceStatus">
                <span id="confluenceStatusIcon">‚è≥</span>
                <span id="confluenceStatusText">Analyzing confluences...</span>
            </div>
            <div class="confluence-reasons" id="confluenceReasons">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- FVG & Order Blocks -->
        <div class="advanced-card">
            <div class="card-title">
                FVG & Order Blocks
                <span class="card-badge">S/R Zones</span>
            </div>
            <div id="fvgSection">
                <div class="indicator-row">
                    <span class="indicator-name">At FVG Zone</span>
                    <span class="indicator-value" id="atFvg">--</span>
                </div>
                <div class="indicator-row">
                    <span class="indicator-name">FVG Count</span>
                    <span class="indicator-value" id="fvgCount">--</span>
                </div>
            </div>
            <div id="orderBlockSection" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-subtle);">
                <div class="indicator-row">
                    <span class="indicator-name">At Order Block</span>
                    <span class="indicator-value" id="atOb">--</span>
                </div>
                <div id="doubleObSection"></div>
            </div>
        </div>

        <!-- Fakeout/Trap Detection -->
        <div class="advanced-card">
            <div class="card-title">
                Fakeout & Trap
                <span class="card-badge">Entry Signal</span>
            </div>
            <div id="fakeoutSection">
                <div class="indicator-row">
                    <span class="indicator-name">Fakeout</span>
                    <span class="indicator-value" id="fakeoutStatus">--</span>
                </div>
                <div class="indicator-row">
                    <span class="indicator-name">Trap (Double Bottom/Top)</span>
                    <span class="indicator-value" id="trapStatus">--</span>
                </div>
                <div id="trapDetail"></div>
            </div>
        </div>

        <!-- Candlestick Patterns -->
        <div class="indicators-card">
            <div class="card-title">
                Candlestick Patterns
                <span class="card-badge">75%</span>
            </div>
            <div id="candlePatterns">
                <div class="indicator-row">
                    <span class="indicator-name">Primary Pattern</span>
                    <span class="indicator-value" id="primaryPattern">--</span>
                </div>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Pattern Strength</span>
                <span class="indicator-value" id="patternStrength">--</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Pattern Bias</span>
                <span class="indicator-value" id="patternBias">--</span>
            </div>
            <div id="allPatterns" style="margin-top: 12px;"></div>
        </div>

        <!-- Volume Analysis -->
        <div class="indicators-card">
            <div class="card-title">
                Volume Analysis
                <span class="card-badge">15%</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Volume Ratio</span>
                <span class="indicator-value" id="volumeRatio">--</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Spike Detected</span>
                <span class="indicator-value" id="volumeSpike">--</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Volume Trend</span>
                <span class="indicator-value" id="volumeTrend">--</span>
            </div>
            <div class="volume-bar-container">
                <div class="volume-bar" id="volumeBar" style="width: 50%;"></div>
            </div>
            <!-- Volume Exit Warning (ÏâΩÏïå: Í±∞ÎûòÎüâ Í∏âÏ¶ù = ÏùµÏ†à ÏãúÍ∑∏ÎÑê) -->
            <div class="exit-warning" id="volumeExitWarning" style="display: none;">
                <span id="volumeExitText">Volume spike = Consider taking profits</span>
            </div>
        </div>

        <!-- Key Levels -->
        <div class="indicators-card">
            <div class="card-title">
                Key Levels
                <span class="card-badge">10%</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">VWAP</span>
                <span class="indicator-value" id="vwapLevel">--</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Price vs VWAP</span>
                <span class="indicator-value" id="priceVsVwap">--</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Nearest Support</span>
                <span class="indicator-value bullish" id="supportLevel">--</span>
            </div>
            <div class="indicator-row">
                <span class="indicator-name">Nearest Resistance</span>
                <span class="indicator-value bearish" id="resistanceLevel">--</span>
            </div>
        </div>

        <!-- AI Analysis -->
        <div class="ai-analysis-card">
            <div class="card-title">Analysis</div>
            <div class="ai-analysis-content" id="aiAnalysis">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                    <span>Waiting for analysis...</span>
                </div>
            </div>

            <!-- Trade Setup -->
            <div class="trade-setup-box" id="tradeSetupBox" style="display: none;">
                <div class="trade-setup-header">
                    <span class="trade-setup-title">Trade Setup</span>
                    <span class="trade-setup-rr" id="riskReward">R:R --</span>
                </div>
                <div class="entry-exit-row">
                    <span class="entry-exit-label">Entry Price</span>
                    <span class="entry-exit-value green" id="entryPrice">--</span>
                </div>
                <div class="reasoning-text" id="entryReasoning"></div>
                <div class="entry-exit-row">
                    <span class="entry-exit-label">Stop Loss</span>
                    <span class="entry-exit-value red" id="stopLoss">--</span>
                </div>
                <div class="reasoning-text" id="stopReasoning"></div>
                <div class="entry-exit-row">
                    <span class="entry-exit-label">Take Profit</span>
                    <span class="entry-exit-value green" id="takeProfit">--</span>
                </div>
                <div class="reasoning-text" id="targetReasoning"></div>
                <!-- R:R Warning -->
                <div class="exit-warning" id="rrWarning" style="display: none;">
                    <span id="rrWarningText"></span>
                </div>
            </div>

            <div class="risk-warning">
                <strong>Risk Warning:</strong> Scalp trading is high-risk. Never risk more than 1-2% of your account per trade. Minimum R:R of 1:2 recommended. Past performance does not guarantee future results.
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>
    let currentTicker = '';
    let currentInterval = '5';
    let currentAssetType = 'stock';
    let tvWidget = null;

    // Detect if ticker is crypto
    function isCryptoTicker(ticker) {
        const cryptoPatterns = [
            /^[A-Z]+USDT$/,  // BTCUSDT, ETHUSDT
            /^[A-Z]+BUSD$/,  // BTCBUSD
            /^[A-Z]+BTC$/,   // ETHBTC
            /^[A-Z]+ETH$/,   // ADAETH
            /^[A-Z]+BNB$/,   // ADABNB
        ];
        return cryptoPatterns.some(pattern => pattern.test(ticker.toUpperCase()));
    }

    // Get TradingView symbol (with exchange prefix)
    function getTVSymbol(ticker) {
        ticker = ticker.toUpperCase();
        if (isCryptoTicker(ticker)) {
            // Use BINANCE for TradingView (works globally)
            return `BINANCE:${ticker}`;
        }
        return ticker;  // Stocks use default exchange
    }

    function setTimeframe(interval) {
        currentInterval = interval;
        document.querySelectorAll('.timeframe-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.interval === interval);
        });
        if (currentTicker) {
            initChart(currentTicker);
            fetchAnalysis(currentTicker);
        }
    }

    function analyzeStock(event) {
        event.preventDefault();
        const ticker = document.getElementById('tickerInput').value.toUpperCase().trim();
        if (!ticker) return false;

        currentTicker = ticker;
        currentAssetType = isCryptoTicker(ticker) ? 'crypto' : 'stock';
        document.getElementById('chartHeader').style.display = 'flex';
        document.getElementById('analysisPanel').style.display = 'flex';

        // Show ticker with asset type badge
        const tickerDisplay = document.getElementById('displayTicker');
        const assetBadge = currentAssetType === 'crypto'
            ? '<span style="font-size: 0.6em; padding: 2px 6px; background: #f7931a; color: #000; border-radius: 4px; margin-left: 8px;">CRYPTO</span>'
            : '<span style="font-size: 0.6em; padding: 2px 6px; background: var(--success); color: #000; border-radius: 4px; margin-left: 8px;">STOCK</span>';
        tickerDisplay.innerHTML = ticker + assetBadge;

        initChart(ticker);
        fetchAnalysis(ticker);

        return false;
    }

    function initChart(ticker) {
        const container = document.getElementById('chartContainer');
        container.innerHTML = '<div id="tradingview_scalp" style="height:500px;"></div>';

        const tvSymbol = getTVSymbol(ticker);
        const timezone = isCryptoTicker(ticker) ? "Etc/UTC" : "America/New_York";

        tvWidget = new TradingView.widget({
            "autosize": true,
            "symbol": tvSymbol,
            "interval": currentInterval,
            "timezone": timezone,
            "theme": "dark",
            "style": "1",
            "locale": "en",
            "toolbar_bg": "#000000",
            "enable_publishing": false,
            "hide_side_toolbar": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_scalp",
            "studies": [
                {"id": "VWAP@tv-basicstudies"},
                {"id": "Volume@tv-basicstudies"}
            ],
            "backgroundColor": "#000000",
            "gridColor": "#1a1a1a"
        });
    }

    async function fetchAnalysis(ticker) {
        // Show loading state
        document.getElementById('signalIcon').className = 'signal-icon loading';
        document.getElementById('signalText').textContent = 'Analyzing...';
        document.getElementById('signalText').className = 'signal-text';
        document.getElementById('signalCard').className = 'signal-card';
        document.getElementById('signalConfidence').textContent = 'Detecting candlestick patterns...';
        document.getElementById('tradeSetupBox').style.display = 'none';
        document.getElementById('reasoningList').innerHTML = '';

        document.getElementById('aiAnalysis').innerHTML = `
            <div class="loading-overlay">
                <div class="spinner"></div>
                <span>Analyzing candlestick patterns...</span>
            </div>
        `;

        try {
            const response = await fetch(`/api/scalp/analyze/${ticker}?interval=${currentInterval}`);
            const data = await response.json();

            if (data.error) {
                throw new Error(data.error);
            }

            updateDisplay(data);
        } catch (error) {
            console.error('Analysis error:', error);
            document.getElementById('signalIcon').className = 'signal-icon bearish';
            document.getElementById('signalCard').className = 'signal-card bearish';
            document.getElementById('signalText').textContent = 'Error';
            document.getElementById('signalText').className = 'signal-text bearish';
            document.getElementById('signalConfidence').textContent = error.message || 'Failed to analyze';
            const assetHint = isCryptoTicker(ticker)
                ? 'Crypto pairs use Binance data (e.g., BTCUSDT, ETHUSDT)'
                : 'Stocks use Polygon data. Ensure market is open.';
            document.getElementById('aiAnalysis').innerHTML = `
                <div style="color: var(--danger); text-align: center; padding: 20px;">
                    Failed to analyze ${ticker}. Please try again.<br>
                    <small style="color: var(--text-tertiary);">${assetHint}</small>
                </div>
            `;
        }
    }

    function updateDisplay(data) {
        // Update price info
        const isCrypto = data.asset_type === 'crypto';
        if (data.price) {
            // Crypto shows more decimals for precision
            const priceDecimals = isCrypto ? (data.price < 1 ? 6 : 2) : 2;
            const priceSymbol = isCrypto ? '' : '$';
            const priceSuffix = isCrypto ? ' USDT' : '';
            document.getElementById('displayPrice').textContent = `${priceSymbol}${data.price.toFixed(priceDecimals)}${priceSuffix}`;
            const changeClass = data.change_percent >= 0 ? 'positive' : 'negative';
            const changeSign = data.change_percent >= 0 ? '+' : '';
            document.getElementById('displayChange').className = `ticker-change ${changeClass}`;
            document.getElementById('displayChange').textContent = `${changeSign}${data.change_percent.toFixed(2)}%`;
        }

        // Update signal card
        const signal = data.signal || 'WAIT';
        const signalCard = document.getElementById('signalCard');
        const signalIcon = document.getElementById('signalIcon');
        const signalText = document.getElementById('signalText');

        if (signal === 'LONG') {
            signalCard.className = 'signal-card bullish';
            signalIcon.className = 'signal-icon bullish';
            signalText.textContent = 'LONG SIGNAL';
            signalText.className = 'signal-text bullish';
        } else if (signal === 'SHORT') {
            signalCard.className = 'signal-card bearish';
            signalIcon.className = 'signal-icon bearish';
            signalText.textContent = 'SHORT SIGNAL';
            signalText.className = 'signal-text bearish';
        } else {
            signalCard.className = 'signal-card neutral';
            signalIcon.className = 'signal-icon neutral';
            signalText.textContent = 'WAIT';
            signalText.className = 'signal-text neutral';
        }

        document.getElementById('signalConfidence').textContent = `Confidence: ${data.confidence || '--'}%`;

        // Update reasoning list
        const reasoningList = document.getElementById('reasoningList');
        if (data.signal_reasoning && data.signal_reasoning.length > 0) {
            reasoningList.innerHTML = data.signal_reasoning.map(r =>
                `<div class="reasoning-item">${r}</div>`
            ).join('');
        } else {
            reasoningList.innerHTML = '';
        }

        // Update candlestick patterns
        const candle = data.candlestick || {};
        const primary = candle.primary_pattern;

        if (primary) {
            const typeClass = primary.type === 'bullish' ? 'bullish' : (primary.type === 'bearish' ? 'bearish' : '');
            document.getElementById('primaryPattern').innerHTML =
                `<span class="${typeClass}">${primary.name}</span>`;
            document.getElementById('patternStrength').textContent = `${primary.strength}/100`;
        } else {
            document.getElementById('primaryPattern').textContent = 'None detected';
            document.getElementById('patternStrength').textContent = '--';
        }

        const patternBias = document.getElementById('patternBias');
        const bias = candle.bias || 'neutral';
        patternBias.textContent = bias.charAt(0).toUpperCase() + bias.slice(1);
        patternBias.className = `indicator-value ${bias === 'bullish' ? 'bullish' : (bias === 'bearish' ? 'bearish' : '')}`;

        // Show all detected patterns
        const allPatternsEl = document.getElementById('allPatterns');
        const patterns = candle.patterns || [];
        if (patterns.length > 0) {
            allPatternsEl.innerHTML = patterns.map(p =>
                `<span class="pattern-badge ${p.type}">${p.name}</span>`
            ).join('');
        } else {
            allPatternsEl.innerHTML = '<span style="color: var(--text-tertiary); font-size: var(--text-xs);">No patterns detected in current candles</span>';
        }

        // Update volume analysis
        const volume = data.volume || {};
        const volumeRatio = volume.ratio || 1;
        document.getElementById('volumeRatio').textContent = `${volumeRatio.toFixed(1)}x avg`;

        const volumeSpike = document.getElementById('volumeSpike');
        if (volume.spike_detected) {
            volumeSpike.textContent = 'Yes';
            volumeSpike.className = 'indicator-value bullish';
        } else {
            volumeSpike.textContent = 'No';
            volumeSpike.className = 'indicator-value';
        }

        const volumeTrend = document.getElementById('volumeTrend');
        volumeTrend.textContent = (volume.trend || 'neutral').charAt(0).toUpperCase() + (volume.trend || 'neutral').slice(1);
        volumeTrend.className = `indicator-value ${volume.trend === 'increasing' ? 'bullish' : ''}`;

        // Update volume bar
        const volumeBar = document.getElementById('volumeBar');
        const barWidth = Math.min(100, volumeRatio * 50);
        volumeBar.style.width = `${barWidth}%`;
        if (volumeRatio >= 2) {
            volumeBar.className = 'volume-bar spike';
        } else if (volumeRatio >= 1.5) {
            volumeBar.className = 'volume-bar high';
        } else if (volumeRatio >= 0.8) {
            volumeBar.className = 'volume-bar normal';
        } else {
            volumeBar.className = 'volume-bar low';
        }

        // Volume Exit Warning (ÏâΩÏïå: Í±∞ÎûòÎüâ Í∏âÏ¶ù = ÏùµÏ†à ÏãúÍ∑∏ÎÑê)
        const volumeExitWarning = document.getElementById('volumeExitWarning');
        if (volume.exit_warning) {
            volumeExitWarning.style.display = 'flex';
            document.getElementById('volumeExitText').textContent = volume.exit_warning;
        } else {
            volumeExitWarning.style.display = 'none';
        }

        // Update Confluence Analysis (ÏâΩÏïå Strategy)
        updateConfluenceCard(data.confluence);

        // Update FVG & Order Blocks
        updateFvgOrderBlocks(data.fvg, data.order_blocks);

        // Update Fakeout/Trap
        updateFakeoutTrap(data.fakeout);

        // Update key levels
        const levels = data.levels || {};
        document.getElementById('vwapLevel').textContent = levels.vwap ? `$${levels.vwap.toFixed(2)}` : '--';

        if (data.price && levels.vwap) {
            const priceVsVwap = document.getElementById('priceVsVwap');
            if (data.price > levels.vwap) {
                priceVsVwap.textContent = 'Above (Bullish)';
                priceVsVwap.className = 'indicator-value bullish';
            } else {
                priceVsVwap.textContent = 'Below (Bearish)';
                priceVsVwap.className = 'indicator-value bearish';
            }
        }

        document.getElementById('supportLevel').textContent = levels.nearest_support ? `$${levels.nearest_support.toFixed(2)}` : 'N/A';
        document.getElementById('resistanceLevel').textContent = levels.nearest_resistance ? `$${levels.nearest_resistance.toFixed(2)}` : 'N/A';

        // Update AI Analysis
        if (data.analysis) {
            document.getElementById('aiAnalysis').innerHTML = data.analysis;
        }

        // Update trade setup
        const setup = data.trade_setup || {};
        if (setup.entry_price) {
            document.getElementById('tradeSetupBox').style.display = 'block';
            document.getElementById('entryPrice').textContent = `$${setup.entry_price.toFixed(2)}`;
            document.getElementById('stopLoss').textContent = `$${setup.stop_loss.toFixed(2)}`;
            document.getElementById('takeProfit').textContent = `$${setup.take_profit.toFixed(2)}`;
            document.getElementById('riskReward').textContent = setup.risk_reward || 'R:R 1:2';

            document.getElementById('entryReasoning').textContent = setup.entry_reasoning || '';
            document.getElementById('stopReasoning').textContent = setup.stop_reasoning || '';
            document.getElementById('targetReasoning').textContent = setup.target_reasoning || '';

            // R:R Warning display
            const rrWarningEl = document.getElementById('rrWarning');
            if (setup.rr_warning) {
                rrWarningEl.style.display = 'flex';
                document.getElementById('rrWarningText').textContent = setup.rr_warning;
            } else {
                rrWarningEl.style.display = 'none';
            }
        } else {
            document.getElementById('tradeSetupBox').style.display = 'block';
            document.getElementById('entryPrice').textContent = '--';
            document.getElementById('stopLoss').textContent = '--';
            document.getElementById('takeProfit').textContent = '--';
            document.getElementById('riskReward').textContent = 'N/A';
            document.getElementById('entryReasoning').textContent = setup.entry_reasoning || 'Wait for clear candlestick pattern';
            document.getElementById('stopReasoning').textContent = '';
            document.getElementById('targetReasoning').textContent = '';
            document.getElementById('rrWarning').style.display = 'none';
        }
    }

    // Confluence Card Update (ÏâΩÏïå Strategy)
    function updateConfluenceCard(confluence) {
        if (!confluence) {
            document.getElementById('confluenceStatusText').textContent = 'No data';
            return;
        }

        const card = document.getElementById('confluenceCard');
        const status = document.getElementById('confluenceStatus');
        const statusIcon = document.getElementById('confluenceStatusIcon');
        const statusText = document.getElementById('confluenceStatusText');
        const reasonsContainer = document.getElementById('confluenceReasons');

        const met = confluence.min_confluence_met;
        const direction = confluence.direction;
        const bullishCount = confluence.bullish_count || 0;
        const bearishCount = confluence.bearish_count || 0;

        // Update card style
        card.className = met ? 'confluence-card met' : 'confluence-card not-met';
        status.className = met ? 'confluence-status met' : 'confluence-status not-met';

        // Update status
        if (met) {
            statusIcon.textContent = '‚úÖ';
            statusText.textContent = `${Math.max(bullishCount, bearishCount)} confluences found - Entry signal!`;
        } else if (bullishCount === 1 || bearishCount === 1) {
            statusIcon.textContent = '‚ö†Ô∏è';
            statusText.textContent = `Only ${Math.max(bullishCount, bearishCount)} confluence - Need 2+ (Í∑ºÍ±∞ 1Í∞ú)`;
        } else {
            statusIcon.textContent = '‚ùå';
            statusText.textContent = 'No confluences - Wait for setup';
        }

        // Build reasons HTML
        let reasonsHtml = '';

        // Bullish reasons
        if (confluence.bullish_reasons && confluence.bullish_reasons.length > 0) {
            confluence.bullish_reasons.forEach(r => {
                reasonsHtml += `
                    <div class="reason-item bullish">
                        <span class="reason-text">üü¢ ${r.reason}</span>
                        <span class="reason-score bullish">+${r.strength}</span>
                    </div>
                `;
            });
        }

        // Bearish reasons
        if (confluence.bearish_reasons && confluence.bearish_reasons.length > 0) {
            confluence.bearish_reasons.forEach(r => {
                reasonsHtml += `
                    <div class="reason-item bearish">
                        <span class="reason-text">üî¥ ${r.reason}</span>
                        <span class="reason-score bearish">+${r.strength}</span>
                    </div>
                `;
            });
        }

        if (!reasonsHtml) {
            reasonsHtml = '<div style="text-align: center; color: var(--text-tertiary); font-size: var(--text-xs); padding: 12px;">No confluences detected in current setup</div>';
        }

        reasonsContainer.innerHTML = reasonsHtml;
    }

    // FVG & Order Blocks Update
    function updateFvgOrderBlocks(fvg, orderBlocks) {
        // FVG Section
        const atFvgEl = document.getElementById('atFvg');
        const fvgCountEl = document.getElementById('fvgCount');

        if (fvg) {
            if (fvg.at_fvg) {
                const fvgType = fvg.at_fvg.type;
                atFvgEl.innerHTML = `<span class="zone-badge ${fvgType}">${fvgType === 'bullish' ? 'üü¢ Support' : 'üî¥ Resistance'} Zone</span>`;
            } else {
                atFvgEl.textContent = 'Not in FVG zone';
            }
            fvgCountEl.textContent = `${fvg.bullish_count || 0} Bullish / ${fvg.bearish_count || 0} Bearish`;
        } else {
            atFvgEl.textContent = '--';
            fvgCountEl.textContent = '--';
        }

        // Order Block Section
        const atObEl = document.getElementById('atOb');
        const doubleObSection = document.getElementById('doubleObSection');

        if (orderBlocks) {
            if (orderBlocks.at_ob) {
                const obType = orderBlocks.at_ob.type;
                atObEl.innerHTML = `<span class="zone-badge ${obType}">${obType === 'bullish' ? 'üü¢ Support' : 'üî¥ Resistance'}</span>`;
            } else {
                atObEl.textContent = 'Not at Order Block';
            }

            // Double Engulfing (Ïù¥Ï§ë Ïû•ÏïÖÌòï) - VERY STRONG!
            if (orderBlocks.double_ob) {
                const doubleType = orderBlocks.double_ob.type;
                doubleObSection.innerHTML = `
                    <div class="double-engulfing-badge">
                        ‚≠ê Ïù¥Ï§ë Ïû•ÏïÖÌòï (Double Engulfing) ‚≠ê<br>
                        <small style="font-weight: normal; color: var(--text-secondary);">
                            ${doubleType === 'bullish' ? 'VERY STRONG Support' : 'VERY STRONG Resistance'} - Strength: ${orderBlocks.double_ob.strength}
                        </small>
                    </div>
                `;
            } else {
                doubleObSection.innerHTML = '';
            }
        } else {
            atObEl.textContent = '--';
            doubleObSection.innerHTML = '';
        }
    }

    // Fakeout/Trap Update
    function updateFakeoutTrap(fakeoutData) {
        const fakeoutStatus = document.getElementById('fakeoutStatus');
        const trapStatus = document.getElementById('trapStatus');
        const trapDetail = document.getElementById('trapDetail');

        if (!fakeoutData) {
            fakeoutStatus.textContent = '--';
            trapStatus.textContent = '--';
            trapDetail.innerHTML = '';
            return;
        }

        // Fakeout
        if (fakeoutData.fakeout) {
            const fo = fakeoutData.fakeout;
            fakeoutStatus.innerHTML = `<span class="zone-badge ${fo.type}">${fo.type === 'bullish' ? 'üü¢ LONG' : 'üî¥ SHORT'}</span>`;
        } else {
            fakeoutStatus.textContent = 'None';
        }

        // Trap (Double Bottom/Top)
        if (fakeoutData.trap) {
            const trap = fakeoutData.trap;
            trapStatus.innerHTML = `<span class="zone-badge ${trap.type}">${trap.type === 'bullish' ? 'üü¢ DETECTED' : 'üî¥ DETECTED'}</span>`;

            trapDetail.innerHTML = `
                <div class="trap-badge ${trap.type === 'bearish' ? 'bearish' : ''}">
                    <div class="trap-title">üéØ ${trap.description}</div>
                    <div class="trap-detail">
                        Stop Loss: $${trap.stop_loss?.toFixed(2) || 'N/A'}<br>
                        Entry: ${trap.entry_logic}
                    </div>
                </div>
            `;
        } else {
            trapStatus.textContent = 'None';
            trapDetail.innerHTML = '';
        }
    }

    // Auto-focus on input
    document.getElementById('tickerInput').focus();
</script>
{% endblock %}
